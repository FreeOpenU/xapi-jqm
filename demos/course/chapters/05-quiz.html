<!DOCTYPE html> 
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <title>Introduction - How to Make French Toast - xapi-jqm</title> 
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <script src="../js/xapiwrapper.min.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/functions.js"></script>
<script>
    function gradeQuestion() {
        var chapter = $("body").attr("data-chapter");
        var pageID = $.mobile.activePage.attr("id");
        var quiz_name = "q" + pageID[1]
        var questionID = quizID + "#" + quiz_name;

        var q_form = $("#" + pageID + "_form :input")
        var question_type = q_form[0].type
        var correct_answer = CORRECT_QUIZ_ANSWERS[parseInt(pageID[1]) - 1];
        var correct_answer_display = [];

        switch ( question_type ) {
            case 'radio':
            case 'checkbox':
                var user_answer = [];
                var user_answer_display = [];
                
                //loop through radio/checkboxex and push ones that were selected
                $("#" + pageID + "_form input").each(function(idx, val) {
                        if ( val.checked ){
                            user_answer.push(idx + 1);
                            user_answer_display.push(this.previousSibling.textContent);
                        }
                        if ( $.inArray(idx+1, correct_answer ) > -1) {
                            correct_answer_display.push(this.previousSibling.textContent);
                        }
                    });

                //compare radio/checkbox selections 
                var success = false;
                if ( correct_answer.join(',') === user_answer.sort().join(',') ) {
                    success = true;
                }

                var stmt = {
                    "actor": actor,
                    "verb": ADL.verbs.answered,
                    "object": {
                        "id" : questionID,
                        "objectType": "Activity",
                        "definition": {
                            "name": {
                                "en-US": moduleName + " " + quiz_name
                            }
                        }
                    },
                    "result": {
                        "success": success,
                        "response": user_answer.toString() + " " + user_answer_display.toString(),
                        "extensions":{
                            "answer:correct_answer": correct_answer.toString() + " " + correct_answer_display.toString()
                        }
                    },
                    "context":createContext(chapter, pageID, "quiz")
                };            
                break;
            case 'text':
                user_answer = q_form.val();
                success = false;
                if ( user_answer === correct_answer ) {
                    success = true;
                }
                var stmt = {
                    "actor": actor,
                    "verb": ADL.verbs.answered,
                    "object": {
                        "id" : questionID,
                        "objectType": "Activity",
                        "definition": {
                            "name": {
                                "en-US": moduleName + " " + quiz_name
                            }
                        }
                    },
                    "result": {
                        "success": success,
                        "response": user_answer,
                        "extensions":{
                            "answer:correct_answer": correct_answer
                        }
                    },
                    "context":createContext(chapter, pageID, "quiz")
                };
                break;
        }
        // Send a statement
        ADL.XAPIWrapper.sendStatement(stmt);
        localStorage.setItem("xapi-jqm/" + actor["name"] + "/" + quiz_name, success);
    }

    function makeAssessment() { 
        var chapter = $("body").attr("data-chapter");    
        var results = [];
        var correct = 0;

        for ( var i=0; i < CORRECT_QUIZ_ANSWERS.length; i++ ) {
            results.push(localStorage.getItem("xapi-jqm/" + actor['name'] + "/" + "q" + (i+1)));
            localStorage.removeItem("xapi-jqm/" + actor['name'] + "/" + "q" + (i+1));
        }

        $.each(results, function(idx, val) {
            if (val === "true"){
                correct++;
            }
        });

        var verb = ADL.verbs.failed;
        var percentage = Math.round( (correct/CORRECT_QUIZ_ANSWERS.length) * 100 )
        var display = "";
        if ( percentage > 60 ) {
            verb = ADL.verbs.passed;
            display = "You passed the quiz! You scored " + percentage + "%"
        } else {
            display = "You failed the quiz! You scored " + percentage + "%"        
        }
        var stmt = {
            "actor": actor,
            "verb": verb,
            "object": quizActivity,
            "result": {
                "score":{
                    "min": 0,
                    "raw": correct,
                    "max": CORRECT_QUIZ_ANSWERS.length
                }
            },
            //hardcoded p1 in there, if put current page it would be the end of the quiz-we want the beginning
            "context": createContext(chapter, "p1")
        };
        // Send a statement
        ADL.XAPIWrapper.sendStatement(stmt);

        setChapterComplete();

        // Mastered statement
        var chaptersCompleted = getChaptersCompleted();
        if ( percentage == 100 && chaptersCompleted.length == 5 ) {
            courseMastered();
            // show a badge by appending to display -- PoC
            display += '<p><img src="../media/488px-badge-french-toast.jpg" alt="French Toast Badge" title="French Toast Badge" style="width:auto;max-width:488px" /></p><h4>French Toast Master</h4><p>Congratulations, you have mastered the course in How to Make French Toast</p>';
        }

        $("#quiz_results").html(display);
    }
</script>    
</head> 

<body data-chapter="05-quiz"> 

<div data-role="page" id="p1">

    <div data-role="header">
        <a href="../index.html#toc" name="home" data-role="button" data-theme="b" data-icon="home" data-transition="slide" data-ajax="false" class="ui-btn-left">Home</a>
        <h1>Take a Quiz</h1>
    </div><!-- /header -->

    <div data-role="content">    
        <div class="infoblock">
            <h2>1. What ingredients are required to make french toast?</h2>
        </div>

        <form id="p1_form">
            <fieldset data-role="controlgroup">
                <input type="checkbox" name="quiz-q1[]" id="q1-chocolate"><label for="q1-chocolate">Chocolate</label>
                <input type="checkbox" name="quiz-q1[]" id="q1-bread"><label for="q1-bread">Bread</label>
                <input type="checkbox" name="quiz-q1[]" id="q1-eggs"><label for="q1-eggs">Eggs</label>
                <input type="checkbox" name="quiz-q1[]" id="q1-hose"><label for="q1-hose">Fire Hose</label>
                <input type="checkbox" name="quiz-q1[]" id="q1-rice"><label for="q1-rice">Rice</label>
                <input type="checkbox" name="quiz-q1[]" id="q1-butter"><label for="q1-butter">Butter / Oil or Non-stick Spray</label>
            </fieldset>
        </form>

    </div><!-- /content -->
    
    <div data-role="footer" data-theme="b" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="../index.html#toc" data-theme="b" data-rel="back" data-icon="carat-l" data-iconpos="top" data-transition="slide" data-direction="reverse" data-ajax="false">Previous</a></li>
                <li><a onclick="gradeQuestion()" href="#p2" id="next" data-theme="b" data-icon="carat-r" data-iconpos="top" data-transition="slide" data-ajax="false">Next</a></li>
            </ul>
        </div><!-- /navbar -->
    </div><!-- /footer -->

</div><!-- /page p1 -->


<div data-role="page" id="p2">

    <div data-role="header">
        <a href="../index.html#toc" name="home" data-role="button" data-theme="b" data-icon="home" data-transition="slide" data-ajax="false" class="ui-btn-left">Home</a>
        <h1>Take a Quiz</h1>
    </div><!-- /header -->

    <div data-role="content">    
        <div class="infoblock">
            <h2>2. Which cooking tool is required to make french toast?</h2>
        </div>

        <form id="p2_form">
            <fieldset data-role="controlgroup">
                <input type="radio" name="quiz-q2[]" id="q2-pot" value="A Pot"><label for="q2-pot">A Pot</label>
                <input type="radio" name="quiz-q2[]" id="q2-toaster" value="A Toaster"><label for="q2-toaster">A Toaster</label>
                <input type="radio" name="quiz-q2[]" id="q2-oven" value="An Oven"><label for="q2-oven">An Oven</label>
                <input type="radio" name="quiz-q2[]" id="q2-pan" value="A Pan or an electric skillet"><label for="q2-pan">A Pan or an electric skillet</label>
                <input type="radio" name="quiz-q2[]" id="q2-blender" value="A Blender"><label for="q2-blender">A Blender</label>
            </fieldset>
        </form>

    </div><!-- /content -->
    
    <div data-role="footer" data-theme="b" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#p1" data-theme="b" data-rel="back" data-icon="carat-l" data-iconpos="top" data-transition="slide" data-direction="reverse" data-ajax="false">Previous</a></li>
                <li><a onclick="gradeQuestion()" href="#p3" id="next" data-theme="b" data-icon="carat-r" data-iconpos="top" data-transition="slide" data-ajax="false">Next</a></li>
            </ul>
        </div><!-- /navbar -->
    </div><!-- /footer -->

</div><!-- /page results -->

<div data-role="page" id="p3">

    <div data-role="header">
        <a href="../index.html#toc" name="home" data-role="button" data-theme="b" data-icon="home" data-transition="slide" data-ajax="false" class="ui-btn-left">Home</a>
        <h1>Take a Quiz</h1>
    </div><!-- /header -->

    <div data-role="content">    
        <div class="infoblock">
            <h2>3. What is the main ingredient of french toast?</h2>
        </div>

        <form id="p3_form">
                <input type="text" data-clear-btn="true" name="quiz-q3[]" id="q3-text">
        </form>

    </div><!-- /content -->
    
    <div data-role="footer" data-theme="b" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#p2" data-theme="b" data-rel="back" data-icon="carat-l" data-iconpos="top" data-transition="slide" data-direction="reverse" data-ajax="false">Previous</a></li>
                <li><a onclick="gradeQuestion();makeAssessment()" href="#results" id="results" data-theme="b" data-icon="carat-r" data-iconpos="top" data-transition="slide" data-ajax="false">Get Results</a></li>
            </ul>
        </div><!-- /navbar -->
    </div><!-- /footer -->

</div><!-- /page results -->

<div data-role="page" id="results">

    <div data-role="header">
        <a href="../index.html#toc" name="home" data-role="button" data-theme="b" data-icon="home" data-transition="slide" data-ajax="false" class="ui-btn-left">Home</a>
        <h1>Quiz Results</h1>
    </div><!-- /header -->

    <div data-role="content">    
        <div class="infoblock">
            <h2 id="quiz_results"></h2>
        </div>

         <a href="../index.html#toc" name="finish" data-role="button" data-theme="b" data-transition="slide" data-ajax="false" class="ui-btn-center">Finish</a>

    </div><!-- /content -->
    
</div><!-- /page results -->
</body>
</html>
